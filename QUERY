CREATE VIEW DESTINATIONRULEMATRIX AS

SELECT 
	TAB1.RULEID,
	TAB2.SOURCECRITERIA as Item,
	TAB3.SOURCECRITERIA as ProgD_Area,
	TAB4.SOURCECRITERIA as BudgetFY,
	TAB5.SOURCECRITERIA as Nation,
	TAB6.SOURCECRITERIA as Programme_Division,
	TAB7.SOURCECRITERIA as SharingKey,
	TAB8.SOURCECRITERIA as MainAccount,
	LEDGERALLOCATIONRULE.ALLOCATIONACTIVE,
	LEDGERALLOCATIONRULE.EFFECTIVESTARTDATE,
	LEDGERALLOCATIONRULE.EFFECTIVEENDDATE,
	LEDGERALLOCATIONRULEDESTINATION.RECID,
	LEDGERALLOCATIONRULEDESTINATION.FIXEDPERCENT,
	LEDGERALLOCATIONRULEDESTINATION.FIXEDWEIGHT,
	DIMENSIONATTRIBUTEVALUESET.NATIONVALUE
	
FROM dbo.LEDGERALLOCATIONRULESOURCE AS TAB1

LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '5637145333'
	)AS TAB2 on TAB1.RULEID = TAB2.RULEID
	
LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '5637145337'
	)AS TAB3 on TAB1.RULEID = TAB3.RULEID
	
LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '5637145326'
	)AS TAB4 on TAB1.RULEID = TAB4.RULEID

LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '5637145334'
	)AS TAB5 on TAB1.RULEID = TAB5.RULEID
	
LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '5637145339'
	)AS TAB6 on TAB1.RULEID = TAB6.RULEID

LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '5637145340'
	)AS TAB7 on TAB1.RULEID = TAB7.RULEID

LEFT JOIN ( SELECT RULEID, SOURCEDIMENSIONATTRIBUTE, SOURCECRITERIA
	FROM LEDGERALLOCATIONRULESOURCE WHERE SOURCEDIMENSIONATTRIBUTE = '0'
	)AS TAB8 on TAB1.RULEID = TAB8.RULEID

JOIN LEDGERALLOCATIONRULE ON LEDGERALLOCATIONRULE.RULEID = TAB1.RULEID

JOIN LEDGERALLOCATIONRULEDESTINATION ON LEDGERALLOCATIONRULEDESTINATION.RULEID = TAB1.RULEID

JOIN DIMENSIONATTRIBUTEVALUESET ON LEDGERALLOCATIONRULEDESTINATION.TODEFAULTDIMENSION = DIMENSIONATTRIBUTEVALUESET.RECID
	
GROUP BY TAB1.RULEID,
	TAB2.SOURCECRITERIA,
	TAB3.SOURCECRITERIA,
	TAB4.SOURCECRITERIA,
	TAB5.SOURCECRITERIA,
	TAB6.SOURCECRITERIA,
	TAB7.SOURCECRITERIA,
	TAB8.SOURCECRITERIA,
	LEDGERALLOCATIONRULE.ALLOCATIONACTIVE,
	LEDGERALLOCATIONRULE.EFFECTIVESTARTDATE,
	LEDGERALLOCATIONRULE.EFFECTIVEENDDATE,
	LEDGERALLOCATIONRULEDESTINATION.RECID,
	LEDGERALLOCATIONRULEDESTINATION.FIXEDPERCENT,
	LEDGERALLOCATIONRULEDESTINATION.FIXEDWEIGHT,
	DIMENSIONATTRIBUTEVALUESET.NATIONVALUE
